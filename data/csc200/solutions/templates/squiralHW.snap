snapshot {
    stage {
        sprite {
            @anything
        }
    }
    @defVar (VAR, GLOBAL, LOCAL, ARG) {
        customBlock:squiral {
            script {
                @anyOrder {
                    @if (VAR, LOCAL) {
                        doDeclareVariables(list(var:length))
                    }
                    down
                    doSetVar(var:length, literal)
                }
                @defVar (LOOP, TIMES, NESTED) {
                    @defBlock BODY {
                        @anyOrder {
                            forward(var:length)
                            @or {
                                turn(literal:90)
                                turnLeft(literal:90)
                            }
                            @or {
                                doChangeVar(var:length, literal)
                                doSetVar(var:length, reportSum(literal, var:length))
                            }
                        }
                    }
                    @if (LOOP, TIMES) {
                        doRepeat(reportProduct(literal:4, var:rotations), script {
                            @block BODY
                        })
                    }
                    @if (LOOP, NESTED) {
                        @defVar (OUTER, VAR, LIT) {
                            doRepeat(@if (OUTER, VAR) { var:rotations } @if (OUTER, LIT) { literal:4 }, script {
                                doRepeat(@if (OUTER, LIT) { var:rotations } @if (OUTER, VAR) { literal:4 }, script {
                                    @block BODY
                                })
                            })
                        }
                    }
                }
                up
            }
            var:rotations
            @if (VAR, ARG) { var:length }
        }
        @if (VAR, GLOBAL) var:length
    }
}
