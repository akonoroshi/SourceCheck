snapshot {
    @defVar (AVERAGE_BLOCK) {
        @defBlock AVERAGE {
            @unless (AVERAGE_BLOCK) { 
                reportRound(reportQuotient(reportSum(var, var), literal))
            }
            @if (AVERAGE_BLOCK) {
                evaluateCustomBlock(var, var)
            }
        }
        stage {
            sprite {
                script {
                    receiveGo
                    evaluateCustomBlock(literal, literal)
                }
                @repeat (2, 2) {
                    script {
                        receiveMessage(literal)
                        doSetVar(literal, var)
                        doSetVar(literal, @block AVERAGE)
                        bubble(reportJoinWords(list(literal, var, literal)))
                    }
                }
                script {
                    receiveMessage(literal)
                    doSayFor(literal, literal)
                }
            }
            @repeat (3, 3) {
                sprite {
                    script {
                        receiveInteraction(literal)
                        doBroadcastAndWait(literal)
                    }
                    @optional {
                        script {
                            @anything
                        }
                    }
                }
            }
            @optional {
                sprite
            }
        }
        @optional {
            customBlock {
                script {
                    tell_to_(literal, script {
                        bubble(literal)
                    })
                    doDeclareVariables(list(literal, literal, literal))
                    doSetVar(literal, reportRandom(literal, literal))
                    doSetVar(literal, literal)
                    doSetVar(literal, reportNewList(list))
                    doUntil(reportEquals(getLastAnswer, var), script {
                        doAsk(literal)
                        doAddToList(getLastAnswer, var)
                        doSetVar(literal, reportSum(literal, var))
                        tell_to_(literal, script {
                            bubble(var)
                        })
                        doSayFor(evaluateCustomBlock(getLastAnswer, var), literal)
                    })
                    doSayFor(reportJoinWords(list(literal, var, literal)), literal)
                }
            }
            customBlock {
                script {
                    doIf(reportEquals(var, var), script {
                        doReport(literal)
                    })
                    doIfElse(reportLessThan(var, var), script {
                        doReport(literal)
                    }, script {
                        doReport(literal)
                    })
                }
                var
                var
            }
            customBlock {
                script {
                    doRun(reportAttributeOf(var, var), list)
                }
                var
                var
            }
            customBlock {
                script {
                    @anyOrder {
                        doSetVar(literal, var)
                        doSetVar(literal, var)
                        doSetVar(literal, @block AVERAGE)
                        @optional {
                            doSayFor(reportJoinWords(list(literal, var, literal, var)), literal)
                        }
                    }
                    bubble(reportJoinWords(list(literal, var, literal)))
                }
                var
                var
            }
        }

        @if (AVERAGE_BLOCK) {
            customBlock {
                script {
                    doReport(reportRound(reportQuotient(reportSum(var, var), literal)))
                }
                var
                var
            }
        }
        var
        var
        var
    }
}