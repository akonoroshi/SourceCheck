snapshot {
    @defVar (AVERAGE_BLOCK) {
        @defVar (COUNT) {
            @defVar (GAME_BLOCK) {
                @defBlock AVERAGE {
                    @unless (AVERAGE_BLOCK) {
                        reportRound(reportQuotient(reportSum(var, var), literal))
                    }
                    @if (AVERAGE_BLOCK) {
                        evaluateCustomBlock(var, var)
                    }
                }
                @defBlock GAME {
                    @anyOrder {
                        doSetVar(literal, @if (GAME_BLOCK) { var } @unless (GAME_BLOCK) { literal })
                        doSetVar(literal, @if (GAME_BLOCK) { var } @unless (GAME_BLOCK) { literal })
                        doSetVar(literal, @block AVERAGE)
                        @if (COUNT) { doSetVar(literal, literal) }
                        @optional {
                            doSayFor(reportJoinWords(list(literal, var, literal, var)), literal)
                        }
                    }
                    bubble(reportJoinWords(list(literal, var, literal)))
                }
                stage {
                    sprite {
                        script {
                            receiveGo
                            @if (GAME_BLOCK) { evaluateCustomBlock(literal, literal) }
                            @unless (GAME_BLOCK) { @block GAME }
                        }
                        @repeat (2, 2) {
                            script {
                                receiveMessage(literal)
                                @if (COUNT) { doChangeVar(literal, literal) }
                                doSetVar(literal, var)
                                doSetVar(literal, @block AVERAGE)
                                bubble(reportJoinWords(list(literal, var, literal)))
                            }
                        }
                        script {
                            receiveMessage(literal)
                            doSayFor(literal, literal)
                        }
                    }
                    @repeat (3, 3) {
                        sprite {
                            script {
                                receiveInteraction(literal)
                                doBroadcastAndWait(literal)
                            }
                            @optional {
                                script {
                                    @anything
                                }
                            }
                        }
                    }
                    @optional {
                        sprite
                    }
                }
                @optional {
                    customBlock {
                        script {
                            tell_to_(literal, script {
                                bubble(literal)
                            })
                            doDeclareVariables(list(literal, literal, literal))
                            doSetVar(literal, reportRandom(literal, literal))
                            doSetVar(literal, literal)
                            doSetVar(literal, reportNewList(list))
                            doUntil(reportEquals(getLastAnswer, var), script {
                                doAsk(literal)
                                doAddToList(getLastAnswer, var)
                                doSetVar(literal, reportSum(literal, var))
                                tell_to_(literal, script {
                                    bubble(var)
                                })
                                doSayFor(evaluateCustomBlock(getLastAnswer, var), literal)
                            })
                            doSayFor(reportJoinWords(list(literal, var, literal)), literal)
                        }
                    }
                    customBlock {
                        script {
                            doIf(reportEquals(var, var), script {
                                doReport(literal)
                            })
                            doIfElse(reportLessThan(var, var), script {
                                doReport(literal)
                            }, script {
                                doReport(literal)
                            })
                        }
                        var
                        var
                    }
                    customBlock {
                        script {
                            doRun(reportAttributeOf(var, var), list)
                        }
                        var
                        var
                    }
                    @if (GAME_BLOCK) {
                        customBlock {
                            script {
                                @block GAME
                            }
                            var
                            var
                        }
                    }
                }

                @if (AVERAGE_BLOCK) {
                    customBlock {
                        script {
                            doReport(reportRound(reportQuotient(reportSum(var, var), literal)))
                        }
                        var
                        var
                    }
                }
                var
                var
                var
                @if (COUNT) { var }
            }
        }
    }
}