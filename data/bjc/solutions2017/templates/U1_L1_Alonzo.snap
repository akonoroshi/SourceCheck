snapshot {
    stage {
        sprite {
            @defVar STAGE (start, greet, loop, ghost) {
                script {
                    receiveInteraction
                    @if (STAGE, start, greet) {
                        @anyOrder {
                            doWearNextCostume
                            gotoXY(reportRandom, reportRandom)
                            @if (STAGE, greet) {
                                bubble
                            }
                        }
                    }
                    @if (STAGE, loop, ghost) {
                        @anyOrder {
                            bubble
                            @if (STAGE, ghost) {
                                changeEffect
                            }
                        }
                        doForever(script {
                            @anyOrder {
                                doWearNextCostume
                                gotoXY(reportRandom, reportRandom)
                            }
                            doWait
                            @if (STAGE, ghost) {
                                changeEffect
                            }
                        })
                    }
                }
                @unless (STAGE, start) {
                    script {
                        receiveGo
                        @anyOrder {
                            gotoXY
                            bubble
                            @if (STAGE, ghost) {
                                setEffect
                            }
                            @optional {
                                doSwitchToCostume
                            }
                        }
                    }
                }
            }
        }
    }
}